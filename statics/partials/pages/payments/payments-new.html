<div class="row" ng-controller="NewPaymentController">
    <div class="col-xl-12">
        <div class="card card-custom gutter-b">
            <div class="card-body">
                <div class="d-flex">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center justify-content-between flex-wrap">
                            <div class="mr-3">
                                <a
                                    href="#"
                                    class="d-flex align-items-center text-dark text-hover-primary font-size-h5 font-weight-bold mr-3"
                                >
                                    PN No. {{ loan.pnNo }}
                                    <span class="label label-light-info label-inline font-weight-bolder ml-2">
                                        {{loan.loanStatus_name}}
                                    </span>
                                    <!-- <i class="fas fa-check-circle text-success icon-md ml-2"></i> -->
                                </a>
                            </div>
                            <div class="my-lg-0 my-1" ng-if="loan"></div>
                        </div>
                        <div class="d-flex align-items-center justify-content-between flex-wrap">
                            <div class="mr-3">
                                <div class="d-flex flex-wrap my-2">
                                    <a
                                        href="#"
                                        class="text-hover-info font-weight-bolder mr-lg-8 mr-5 mb-lg-0 mb-2 text-primary"
                                        ng-click="viewBorrower(loan.borrower)"
                                    >
                                        {{ loan.borrower_name }}
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center flex-wrap justify-content-between">
                            <div class="flex-grow-1 font-weight-bold text-dark-50 mr-5">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Program:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.loanProgram_name }}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Loan Amount:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.amount | currency :'₱'}}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Interest Rate:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.interestRate_amount }}
                                        <span>%</span>
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Term:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.term_name }}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Purpose:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.purpose }}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="font-weight-bolder mr-2">Security:</span>
                                    <span class="font-weight-bolder text-dark">
                                        {{ loan.security }}
                                    </span>
                                </div>
                            </div>
                            <div class="d-flex flex-wrap align-items-center py-2">
                                <div class="d-flex align-items-center" ng-show="loan.dateReleased">
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Approval Date</div>
                                        <span
                                            class="btn btn-sm btn-text btn-light-primary text-uppercase font-weight-bold"
                                        >
                                            {{ loan.creditLine_dateApproved | date: 'mediumDate' }}
                                        </span>
                                    </div>
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Expiry Date</div>
                                        <span
                                            class="btn btn-sm btn-text btn-light-danger text-uppercase font-weight-bold"
                                        >
                                            {{ loan.creditLine_dateExpired | date: 'mediumDate' }}
                                        </span>
                                    </div>
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Released Date</div>
                                        <span
                                            class="btn btn-sm btn-text btn-light-primary text-uppercase font-weight-bold"
                                        >
                                            {{ loan.dateReleased | date: 'mediumDate' }}
                                        </span>
                                    </div>
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Maturity Date</div>
                                        <span
                                            class="btn btn-sm btn-text btn-light-danger text-uppercase font-weight-bold"
                                        >
                                            {{ loan.lastAmortizationItem.schedule | date: 'mediumDate' }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="separator separator-solid my-7"></div>
                <div class="d-flex align-items-center flex-wrap">
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-calendar-week icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Program</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ loan.loanProgram_name }}
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Loan Amount</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ loan.amount | currency :'₱'}}
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Total Interest</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ loan.totalAmortizationInterest | currency :'₱'}}
                            </span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Total Payment</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ loan.totalPayment | currency :'₱'}}
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Outstanding Balance</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{loan.outStandingBalance | currency :'₱'}}
                            </span>
                        </div>
                    </div>
                    <!-- <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Remaining Credit Line Amount</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ document.creditLine.remainingCreditLine | currency :'₱'}}
                            </span>
                        </div>
                    </div> -->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Principal Balance</span>
                            <span class="font-weight-bolder font-size-h5" ng-if="loan.latestPayment">
                                {{ loan.latestPayment.outStandingBalance | currency :'₱'}}
                            </span>
                            <span class="font-weight-bolder font-size-h5" ng-if="!loan.latestPayment">
                                {{ loan.totalObligations | currency :'₱'}}
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="fad fa-coins icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Interest Balance</span>
                            <span class="font-weight-bolder font-size-h5">
                                {{ loan.interestBalance | currency :'₱'}}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card card-custom gutter-b" block-ui="addPaymentBlockUI">
            <div class="card-header">
                <div class="card-title">
                    <h3 class="card-label">
                        Add Payment
                        <span class="text-muted pt-2 font-size-sm d-block"></span>
                    </h3>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered mb-0">
                        <thead class="table-active">
                            <tr>
                                <th>
                                    <div class="pl-16">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Schedule
                                        </span>
                                    </div>
                                </th>
                                <th>
                                    <div class="text-right pl-16">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Days
                                        </span>
                                    </div>
                                </th>
                                <th>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Principal
                                        </span>
                                    </div>
                                </th>
                                <th>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Accrued Interest
                                        </span>
                                    </div>
                                </th>
                                <th>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Interest
                                        </span>
                                    </div>
                                </th>
                                <th>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 text-uppercase font-size-lg">
                                            Total Amortization
                                        </span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="pl-16">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.schedule | date :'mediumDate'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right pl-16">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.days }}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.principal | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.accruedInterest | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.interest - loan.currentAmortizationItem.accruedInterest  | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{loan.currentAmortizationItem.total | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <thead class="table-active">
                                <tr>
                                    <th>
                                        <div class="pl-16">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Payment Date
                                            </span>
                                        </div>
                                    </th>
                                    <th style="width: 15%;">
                                        <div class="text-right pl-16">
                                            <span
                                                class="text-dark-75 text-uppercase font-size-lg"
                                                ng-if="payment.daysExceed > 0"
                                            >
                                                Days Delayed
                                            </span>
                                            <span
                                                class="text-dark-75 text-uppercase font-size-lg"
                                                ng-if="payment.daysAdvanced > 0"
                                            >
                                                Days Advanced
                                            </span>
                                            <span
                                                class="text-dark-75 text-uppercase font-size-lg"
                                                ng-if="payment.daysAdvanced == 0 && payment.daysExceed == 0 "
                                            >
                                                Days
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Principal
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                             Accrued Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Total Amortization
                                            </span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tr>
                                <td>
                                    <div class="pl-16">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{payment.datePayment | date :'mediumDate'}}
                                        </span>
                                    </div>
                                </td>
                                <td style="width: 20%;">
                                    <div class="d-flex align-items-center justify-content-end">
                                        <div ng-if="payment.daysExceed > 0">
                                            <a
                                                class="btn btn-success btn-sm text-uppercase"
                                                ng-click="paymentExtension(payment.isPaymentExtension)"
                                            >
                                                {{ isPaymentExtensionButton }}
                                            </a>
                                             
                                        </div>
                                        <div class="ml-3">
                                            <span
                                                class="text-dark-75 font-weight-bolder font-size-lg"
                                                ng-if="payment.daysExceed > 0"
                                            >
                                                {{payment.daysExceed }}
                                            </span>
                                            <span
                                                class="text-dark-75 font-weight-bolder font-size-lg"
                                                ng-if="payment.daysAdvanced > 0"
                                            >
                                                {{payment.daysAdvanced }}
                                            </span>
                                            <span
                                                class="text-dark-75 font-weight-bolder font-size-lg"
                                                ng-if="payment.daysAdvanced == 0 && payment.daysExceed == 0 "
                                            >
                                                {{payment.days }}
                                            </span>
                                        </div>
                                    </div>
                                     
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{payment.principal | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{payment.accruedInterest | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{payment.interest - payment.accruedInterest | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-right px-2">
                                        <span class="text-dark-75 font-weight-bolder font-size-lg">
                                            {{payment.totalToPay | currency :'₱'}}
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-body">
                <form class="form mt-0" name="newPaymentForm">
                    <div class="row justify-content-center p-5">
                        <div class="col-lg-8 pr-8">
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label>Payment Type:</label>
                                    <select
                                        class="form-control"
                                        id="paymentType"
                                        name="paymentType"
                                        ng-model="payment.paymentType"
                                        ng-options="paymentType.id as (paymentType.name) for paymentType in paymentTypes"
                                        ng-class="{'is-invalid' : newPaymentForm.paymentType.$invalid &&
                                        newPaymentForm.paymentType.$touched, 'is-valid' : newPaymentForm.paymentType.$valid && newPaymentForm.paymentType.$touched }"
                                        required
                                    ></select>
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.paymentType.$touched && newPaymentForm.paymentType.$invalid"
                                    >
                                        Please select payment type.
                                    </span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-4">
                                    <label>Payment Date:</label>
                                    <input
                                        type="date"
                                        min="0"
                                        class="form-control"
                                        id="datePayment"
                                        name="datePayment"
                                        ng-model="payment.datePayment"
                                        ng-class="{'is-invalid' : newPaymentForm.datePayment.$invalid && newPaymentForm.datePayment.$touched   }"
                                        required
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.datePayment.$touched && newPaymentForm.datePayment.$invalid"
                                    >
                                        Please enter payment date.
                                    </span>
                                </div>
                                <div class="col-lg-2" ng-if="payment.paymentType">
                                    <label>Penalty Payment:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        step="0.01"
                                        class="form-control"
                                        placeholder="0"
                                        id="penaltyPayment"
                                        name="penaltyPayment"
                                        ng-model="payment.penaltyPayment"
                                        ng-class="{'is-invalid' : newPaymentForm.penaltyPayment.$invalid && newPaymentForm.penaltyPayment.$touched   || exceeded, 'is-valid' : newPaymentForm.penaltyPayment.$valid && newPaymentForm.penaltyPayment.$touched && !exceeded }"
                                        required
                                        price
                                        ng-disabled="payment.penalty <= 0"
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.penaltyPayment.$touched && newPaymentForm.penaltyPayment.$invalid"
                                    >
                                        Please enter payment for penalty.
                                    </span>
                                </div>
                                <div class="col-lg-2" ng-if="payment.paymentType">
                                    <label>A.I. Payment:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        step="0.01"
                                        class="form-control"
                                        placeholder="0"
                                        id="accruedInterestPayment"
                                        name="accruedInterestPayment"
                                        ng-model="payment.accruedInterestPayment"
                                        ng-class="{'is-invalid' : newPaymentForm.accruedInterestPayment.$invalid && newPaymentForm.accruedInterestPayment.$touched   || exceeded, 'is-valid' : newPaymentForm.accruedInterestPayment.$valid && newPaymentForm.accruedInterestPayment.$touched && !exceeded }"
                                        required
                                        price
                                        ng-disabled="payment.penaltyBalance >= 1"
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.accruedInterestPayment.$touched && newPaymentForm.accruedInterestPayment.$invalid"
                                    >
                                        Please enter payment for accrued interest.
                                    </span>
                                </div>
                                <div class="col-lg-2" ng-if="payment.paymentType">
                                    <label>Interest Payment:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        step="0.01"
                                        class="form-control"
                                        placeholder="0"
                                        id="interestPayment"
                                        name="interestPayment"
                                        ng-model="payment.interestPayment"
                                        ng-class="{'is-invalid' : newPaymentForm.interestPayment.$invalid && newPaymentForm.interestPayment.$touched   || exceeded, 'is-valid' : newPaymentForm.interestPayment.$valid && newPaymentForm.interestPayment.$touched && !exceeded }"
                                        required
                                        price
                                        ng-disabled="payment.penaltyBalance >= 1"
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.interestPayment.$touched && newPaymentForm.interestPayment.$invalid"
                                    >
                                        Please enter payment for interest.
                                    </span>
                                </div>

                                <div class="col-lg-2" ng-if="payment.paymentType != '2' && payment.paymentType">
                                    <label>Principal Payment:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        step="0.01"
                                        class="form-control"
                                        placeholder="0"
                                        id="cash"
                                        name="cash"
                                        ng-model="payment.cash"
                                        ng-class="{'is-invalid' : newPaymentForm.cash.$invalid && newPaymentForm.cash.$touched   || exceeded, 'is-valid' : newPaymentForm.cash.$valid && newPaymentForm.cash.$touched && !exceeded }"
                                        required
                                        price
                                        ng-disabled="payment.interestBalance >= 1"
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.cash.$touched && newPaymentForm.cash.$invalid"
                                    >
                                        Please enter cash tendered.
                                    </span>
                                </div>

                                <div class="col-lg-2" ng-if="payment.paymentType == '2'  && payment.paymentType">
                                    <label>Principal Payment:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        step="0.01"
                                        class="form-control"
                                        placeholder="0"
                                        id="check"
                                        name="check"
                                        ng-model="payment.check"
                                        ng-class="{'is-invalid' : newPaymentForm.check.$invalid && newPaymentForm.check.$touched   || exceeded, 'is-valid' : newPaymentForm.check.$valid && newPaymentForm.check.$touched && !exceeded }"
                                        required
                                        price
                                        ng-disabled="payment.interestBalance >= 1"
                                    />

                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.check.$touched && newPaymentForm.check.$invalid"
                                    >
                                        Please enter check tendered.
                                    </span>
                                </div>
                            </div>

                            <div class="form-group row">
                                <table>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Post Dated Check
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{loan.currentAmortizationItem.latestCheck.checkNo}}  
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Banck Branch
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                   {{loan.currentAmortizationItem.latestCheck.bankBranch}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <div class="form-group row" ng-if="payment.paymentType == '2' && !loan.currentAmortizationItem.latestCheck">
                                <div class="col-lg-6">
                                    <label>Check No:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        class="form-control"
                                        id="checkNo"
                                        name="checkNo"
                                        ng-model="payment.checkNo"
                                        ng-class="{'is-invalid' : newPaymentForm.checkNo.$invalid && newPaymentForm.checkNo.$touched, 'is-valid' : newPaymentForm.checkNo.$valid && newPaymentForm.checkNo.$touched }"
                                        required
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.checkNo.$touched && newPaymentForm.checkNo.$invalid"
                                    >
                                        Please enter Check No.
                                    </span>
                                </div>
                                <div class="col-lg-6">
                                    <label>Bank Account:</label>
                                    <input
                                        type="text"
                                        min="0"
                                        class="form-control"
                                        id="bankAccount"
                                        name="bankAccount"
                                        ng-model="payment.bankAccount"
                                        ng-class="{'is-invalid' : newPaymentForm.bankAccount.$invalid && newPaymentForm.bankAccount.$touched, 'is-valid' : newPaymentForm.bankAccount.$valid && newPaymentForm.bankAccount.$touched }"
                                        required
                                    />
                                    <span
                                        class="form-text text-muted"
                                        ng-show="newPaymentForm.bankAccount.$touched && newPaymentForm.bankAccount.$invalid"
                                    >
                                        Please enter Bank Account
                                    </span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label>Description:</label>
                                    <textarea
                                        type="text"
                                        rows="4"
                                        cols="50"
                                        class="form-control textarea"
                                        ng-model="payment.description"
                                    ></textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label>Remarks:</label>
                                    <textarea
                                        type="text"
                                        rows="4"
                                        cols="50"
                                        class="form-control textarea"
                                        ng-model="payment.remarks"
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 border-left">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td colspan="2">
                                            <div class="text-left pl-4">
                                                <span
                                                    class="text-dark-75 font-weight-bolder text-uppercase font-size-lg"
                                                >
                                                    Loan Details
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Loan Amount
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{loan.amount | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Interest
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{loan.totalAmortizationInterest | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="border-top: 1pt solid #464e5f !important;">
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{ loan.totalObligations | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="text-left pl-4 pt-4">
                                                <span
                                                    class="text-dark-75 font-weight-bolder text-uppercase font-size-lg"
                                                >
                                                    Amortization Details
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Outstanding Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{loan.outStandingBalance | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Principal
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.principal | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Interest
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.interest | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="border-top: 1pt solid #464e5f !important;">
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total Amortization
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.totalToPay | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Additional Interest
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.additionalInterest | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total Interest
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.totalInterest | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Penalty
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.penalty | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="border-top: 1pt solid #464e5f !important;">
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total to Pay
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.totalToPayWithPenalty | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="text-left pl-4 pt-4">
                                                <span
                                                    class="text-dark-75 font-weight-bolder text-uppercase font-size-lg"
                                                >
                                                    Summary
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Penalty Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.penaltyPayment | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Accrued Interest Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.accruedInterestPayment | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Interest Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.interestPayment | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Principal Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.cash + payment.check | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="border-top: 1pt solid #464e5f !important;">
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.total | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Penalty Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.penaltyBalance | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Interest Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.interestBalance | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Principal Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.principal - (payment.cash + payment.check) | currency
                                                    :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="border-top: 1pt solid #464e5f !important;">
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Total Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.balance | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Over Payment
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.overPayment | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="pl-4">
                                                <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                    Principal Balance
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="text-right px-2">
                                                <span class="text-dark-75 font-size-lg">
                                                    {{payment.outStandingBalance | currency :'₱'}}
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between border-top mt-5 pt-5">
                        <div class="mr-2">
                            <button
                                class="btn btn-light-primary text-uppercase p-2 pl-3 pr-3"
                                ng-click="cancel(loan.id)"
                            >
                                Cancel
                            </button>
                        </div>
                        <div>
                            <button
                                class="btn btn-success text-uppercase p-2 pl-3 pr-3"
                                ng-click="save()"
                                ng-disabled="insufficient || payment.total <= 0 "
                                 
                            >
                                Accept Payment
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
       
           

        <div class="card card-custom gutter-b" ng-if="loan.dateReleased" ng-init="showAmortizationSchedules = true">
            <div class="card-header align-items-center border-0">
                <h3 class="card-title align-items-start flex-column">
                    <span class="font-weight-bolder text-dark">Amortization Schedule</span>
                    <span class="text-muted mt-3 font-weight-bold font-size-sm">
                        Date Created: {{loan.latestAmortization.dateCreated | date : 'mediumDate' }}
                    </span>
                </h3>
                <div class="card-toolbar">
                    <a
                        href="#"
                        class="btn btn-sm btn-light-success font-weight-bolder text-uppercase mr-3"
                        ng-click="previewAmortizationSchedule(loan.id)"
                    >
                        Print
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="slide" ng-show="showAmortizationSchedules">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead class="table-active">
                                <tr>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                No.
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Schedule
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Days
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Principal
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Accrued Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Add. Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Penalty
                                            </span>
                                        </div>
                                    </th>
                                    <!-- <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                VAT
                                            </span>
                                        </div>
                                    </th> -->
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Total Amortization
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Principal Balance
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Status
                                            </span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                0
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.latestAmortization.dateReleased | date: 'mediumDate' }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <!-- <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td> -->
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.latestAmortization.totalAmortizationPrincipal | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr ng-repeat="amortization in loan.latestAmortization.amortizationItems">
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{$index+1 }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.schedule | date: 'mediumDate' }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.days}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.principal | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                
                                                {{ amortization.accruedInterest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.interest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.additionalInterest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.penalty | currency :'₱'}}
                                            </span>

                                            <span
                                                class="text-dark-75 font-weight-bolder font-size-lg"
                                                ng-if="amortization.penalty > 0"
                                            >
                                                (+{{ amortization.daysExceed }} days)
                                            </span>
                                        </div>
                                    </td>
                                    <!-- <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.vat | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td> -->
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.total | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.principalBalance | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ amortization.amortizationStatus_name}}
                                            </span>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="table-success">
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                Total
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.latestAmortization.totalAmortizationPrincipal | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.totalAmortizationAccruedInterest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.totalAmortizationInterest - loan.totalAmortizationAccruedInterest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <!-- <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td> -->
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-center p-0">
                <a class="btn btn-icon" ng-click="showAmortizationSchedules = !showAmortizationSchedules">
                    <i
                        class="wide text-warning"
                        ng-class=" showAmortizationSchedules ? 'fal fa-angle-up' : 'fal fa-angle-down' "
                    ></i>
                </a>
            </div>
        </div>

        <div class="card card-custom gutter-b" ng-if="loan.dateReleased" ng-init="showPaymentHistory = true">
            <div class="card-header align-items-center border-0">
                <h3 class="card-title align-items-start flex-column">
                    <span class="font-weight-bolder text-dark">Payment History</span>
                </h3>
                <div class="card-toolbar">
                    <a
                        href="#"
                        class="btn btn-sm btn-light-success font-weight-bolder text-uppercase mr-3"
                        ng-click="previewPaymentHistory(loan.id)"
                    >
                        Print
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="slide" ng-show="showPaymentHistory">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead class="table-active">
                                <tr>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Payment For
                                            </span>
                                        </div>
                                    </th>

                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Principal
                                            </span>
                                        </div>
                                    </th>

                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Additional Interest
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Penalty
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Amortization
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Total Payable
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Payment Date
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Payment Type
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Total Payment
                                            </span>
                                        </div>
                                    </th>

                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Balance
                                            </span>
                                        </div>
                                    </th>
                                    <th>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Overpayment
                                            </span>
                                        </div>
                                    </th>
                                    <!-- <th>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 text-uppercase font-size-lg">
                                                Date Tendered
                                            </span>
                                        </div>
                                    </th> -->
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="payment in loan.payments">
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.amortizationItem_schedule | date: 'mediumDate' }}
                                            </span>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.principal | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.interest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.additionalInterest | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.penalty | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.totalToPay | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.totalToPayWithPenalty | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.datePayment | date: 'mediumDate' }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.paymentType_name }}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.total | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.balance | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.overPayment | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <!-- <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ payment.dateCreated | date: 'mediumDate' }}
                                            </span>
                                        </div>
                                    </td> -->
                                </tr>
                                <tr class="table-success">
                                    <td>
                                        <div class="text-center px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                Total
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg">
                                                {{ loan.totalPayment | currency :'₱'}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="text-right px-2">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td>
                                    <!-- <td>
                                        <div class="text-right">
                                            <span class="text-dark-75 font-weight-bolder font-size-lg"></span>
                                        </div>
                                    </td> -->
                                </tr>
                            </tbody>
                        </table>
                        <div
                            class="d-flex justify-content-center align-items-center flex-wrap"
                            ng-if="pageRangeDocument((borrower.documents | filter: {subProcess:{id:subProcess.id}}).length).length > 1"
                        >
                            <div class="d-flex flex-wrap py-2 mr-3">
                                <button
                                    href="#"
                                    class="btn btn-circle btn-icon btn-xs btn-light-primary mr-2 my-1"
                                    ng-disabled="currentPageDocument(subProcess) == 0"
                                    ng-click="gotoPrevDocument(subProcess)"
                                >
                                    <i class="fas fa-chevron-left icon-sm"></i>
                                </button>
                                <button
                                    href="#"
                                    class="btn btn-circle btn-icon btn-xs border-0 btn-hover-primary mr-2 my-1"
                                    ng-class="{ 'active' : n == currentPageDocument(subProcess) + 1 }"
                                    ng-repeat="n in pageRangeDocument(borrower.documents.length)"
                                    ng-click="jumpToPageDocument(n,subProcess)"
                                >
                                    <small>{{n}}</small>
                                </button>
                                <button
                                    href="#"
                                    class="btn btn-circle btn-icon btn-xs btn-light-primary mr-2 my-1"
                                    ng-disabled="currentPageDocument(subProcess) >=borrower.documents.length/pageSizeDocument - 1"
                                    ng-click="gotoNextDocument(subProcess)"
                                >
                                    <i class="fas fa-chevron-right icon-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-center p-0">
                <a class="btn btn-icon" ng-click="showPaymentHistory = !showPaymentHistory">
                    <i
                        class="wide text-warning"
                        ng-class=" showPaymentHistory ? 'fal fa-angle-up' : 'fal fa-angle-down' "
                    ></i>
                </a>
            </div>
        </div>
    </div>

    <div class="col-xl-5">
        <div class="card card-custom card-stretch gutter-b">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">
                        <i class="fad fa-users-class"></i>
                    </span>
                    <h3 class="card-label">Notes</h3>
                </div>
            </div>
            <div class="card-body" block-ui="noteBlockUI">
                <div class="container">
                    <form class="form">
                        <div class="form-group">
                            <textarea
                                class="form-control form-control-lg form-control-solid"
                                ng-model="newNote.noteDescription"
                                name="noteDescription"
                                rows="3"
                                placeholder="Type notes"
                            ></textarea>
                        </div>
                        <div class="d-flex justify-content-end">
                            <a
                                href="#"
                                class="btn btn-light-primary font-weight-bold"
                                ng-disabled="!newNote.noteDescription"
                                ng-click="addNote(document)"
                            >
                                <i class="fal fa-plus mr-2"></i>
                                Add Notes
                            </a>
                        </div>
                    </form>
                    <div class="separator separator-dashed my-10"></div>
                    <div class="timeline timeline-3 pb-5">
                        <div class="timeline-items">
                            <div
                                class="timeline-item"
                                ng-repeat="note in notes | orderBy:'-'  | startFrom:currentPage.notes * pageSize.notes | limitTo: pageSize.notes "
                            >
                                <div class="timeline-media">
                                    <i class="fad fa-sticky-note text-primary"></i>
                                </div>
                                <div class="timeline-content">
                                    <p class="p-0">
                                        {{ note.note}}
                                    </p>
                                    <small class="text-dark-75 font-weight-bold">
                                        {{ note.committeeName }}
                                    </small>
                                    <br />
                                    <small class="text-muted">{{ note.action_time | date : 'medium' }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="notes">
                        <pagination
                            data="notes"
                            page-size="pageSize.notes"
                            currentpage="currentPage.notes"
                        ></pagination>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3"></div>

    <div class="col-xl-9"></div>
</div>
